<!DOCTYPE html>
<html>
<head>
    <title>Teste Painel Gerencial</title>
    <meta name="csrf-token" content="teste">
    <style>
        body { font-family: Arial; padding: 20px; }
        .test-result { padding: 10px; margin: 10px 0; border: 1px solid #ddd; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        button { padding: 10px 20px; cursor: pointer; }
    </style>
</head>
<body>
    <h1>Teste do Painel Gerencial</h1>
    
    <div class="test-result" id="result1"></div>
    <button onclick="testFunctions()">Testar Funções</button>
    
    <h2>Elementos do DOM</h2>
    <div class="test-result" id="result2"></div>
    <button onclick="testDOM()">Testar DOM</button>
    
    <h2>Popups</h2>
    <div class="test-result" id="result3"></div>
    <button onclick="testPopups()">Testar Popups</button>
    
    <hr>
    <h2>Console Output</h2>
    <pre id="console-output" style="background: #f5f5f5; padding: 10px; max-height: 300px; overflow-y: auto;"></pre>

    <script>
        const consoleLog = [];
        const originalLog = console.log;
        console.log = function(...args) {
            consoleLog.push(args.join(' '));
            document.getElementById('console-output').textContent = consoleLog.join('\n');
            originalLog.apply(console, args);
        };

        function testFunctions() {
            console.log('=== Testando Funções ===');
            const functions = [
                'openNewProductPopup',
                'closeNewProductPopup',
                'createProduct',
                'openEditProductPopup',
                'closeEditProductPopup',
                'updateProduct',
                'openCategoriesPopup',
                'closeCategoriesPopup',
                'loadCategories',
                'addNewCategory',
                'deleteCategory'
            ];
            
            let result = '<strong>Funções JavaScript:</strong><br>';
            let allFound = true;
            
            functions.forEach(fn => {
                const exists = typeof window[fn] === 'function';
                const status = exists ? '✓' : '✗';
                const color = exists ? 'green' : 'red';
                result += `<span style="color: ${color};">${status} ${fn}</span><br>`;
                if (!exists) allFound = false;
            });
            
            document.getElementById('result1').className = allFound ? 'test-result success' : 'test-result error';
            document.getElementById('result1').innerHTML = result;
        }
        
        function testDOM() {
            console.log('=== Testando DOM ===');
            const elements = [
                'editProductPopup',
                'newProductPopup',
                'categoriesPopup',
                'edit_product_id',
                'new_name',
                'categoriesList'
            ];
            
            let result = '<strong>Elementos no DOM:</strong><br>';
            let allFound = true;
            
            elements.forEach(el => {
                const exists = document.getElementById(el) !== null;
                const status = exists ? '✓' : '✗';
                const color = exists ? 'green' : 'red';
                result += `<span style="color: ${color};">${status} #${el}</span><br>`;
                if (!exists) allFound = false;
            });
            
            document.getElementById('result2').className = allFound ? 'test-result success' : 'test-result error';
            document.getElementById('result2').innerHTML = result;
        }
        
        function testPopups() {
            console.log('=== Testando Popups ===');
            const popup = document.getElementById('editProductPopup');
            if (!popup) {
                document.getElementById('result3').className = 'test-result error';
                document.getElementById('result3').innerHTML = '✗ Popups não encontrados no DOM';
                return;
            }
            
            const display = popup.style.display;
            document.getElementById('result3').className = 'test-result success';
            document.getElementById('result3').innerHTML = `
                ✓ Popups encontrados<br>
                Display atual: ${display || 'none'}<br>
                <button onclick="testPopupOpen()">Tentar Abrir Popup</button>
            `;
        }
        
        function testPopupOpen() {
            try {
                document.getElementById('editProductPopup').style.display = 'flex';
                console.log('Popup aberto com sucesso');
            } catch(e) {
                console.error('Erro ao abrir popup:', e.message);
            }
        }
        
        // Auto-run testes ao carregar
        window.addEventListener('load', () => {
            console.log('Página carregada');
            testFunctions();
            testDOM();
            testPopups();
        });
    </script>
</body>
</html>
